Z.ns("Z.cmp");Z.cmp.PageList=function(C){C.pageNavCount=C.pageNavCount||10;C.pageSize=C.pageSize||100000;C.id=C.id||new Date().getTime();C.pageInfo=$E(C.pageInfo);if(C.pageInfo)C.pageInfo_HTML=C.pageInfo.innerHTML;C.page_tl_first=C.page_tl_first||"<a href=# onclick=\"Z.cmp.PageList.go('{cmpid}',1);return false;\">\u9996\u9875</a>";C.page_tl_pre=C.page_tl_pre||"<a href=# onclick=\"return Z.cmp.PageList.go('{cmpid}',-1);return false;\">\u4e0a\u4e00\u9875</a>";C.page_tl_next=C.page_tl_next||"<a href=# onclick=\"return Z.cmp.PageList.go('{cmpid}',-2);return false;\">\u4e0b\u4e00\u9875</a>";C.page_tl_last=C.page_tl_last||"<a href=# onclick=\"return Z.cmp.PageList.go('{cmpid}',-3);return false;\">\u5c3e\u9875</a>";C.page_tl_curr=C.page_tl_curr||"<span class=\"curr\">{pageIndex}</span>";C.page_tl_index=C.page_tl_index||"<a href=# onclick=\"Z.cmp.PageList.go('{cmpid}',{pageIndex});return false;\">{pageIndex}</a>";C.page_tl_first=C.page_tl_first.format({"cmpid":C.id});C.page_tl_pre=C.page_tl_pre.format({"cmpid":C.id});C.page_tl_next=C.page_tl_next.format({"cmpid":C.id});C.page_tl_last=C.page_tl_last.format({"cmpid":C.id});C.page_tl_curr=C.page_tl_curr.format({"cmpid":C.id});C.page_tl_index=C.page_tl_index.format({"cmpid":C.id});var _=function(K,_){var E=K.totalCount;C.maxPageN=Math.ceil(E/C.pageSize);if(Z.isObject(C.pageInfo)){Z.disp(C.pageInfo,true);C.pageInfo.innerHTML=C.pageInfo_HTML.format({"pageN":C.maxPageN,"pageSize":C.pageSize,"totalCount":E})}if((!Z.isDefined(C.pageWrap)&&!Z.isFunction(C.pageEvent))||C.pageSize==100000){_();return}else if(!Z.isFunction(C.pageEvent)){var G=$E(C.pageWrap);if(!G){alert("pageWrap\u5143\u7d20\u672a\u627e\u5230\uff0c\u8bf7\u68c0\u67e5\uff01cfg.pageWrap="+C.pageWrap);return}else if(E<=0){G.innerHTML="\u6ca1\u6709\u6570\u636e!";_();return}}if(C.toPageN>C.maxPageN){C.toPageN=C.maxPageN;var L=Z.getCmp(C.id).p;L.start=(C.toPageN-1)*C.pageSize;L.limit=C.pageSize;A(L);return}var N=0,H=1,F=0,J=Math.floor(C.pageNavCount-1/2);for(var I=1;I<=J;I++)if(C.toPageN-I>0){H=C.toPageN-I;N++}else break;var M=F=C.toPageN;N++;for(I=1;I<=C.pageNavCount-N;I++)if(M+I<=C.maxPageN)F=M+I;else break;if(G)G.innerHTML="";else if(C.pageEvent)C.pageEvent("clear");var B=new Ext.Template(C.page_tl_curr),$=new Ext.Template(C.page_tl_index);if(C.toPageN>1)if(G)Ext.DomHelper.append(G,C.page_tl_first+C.page_tl_pre);else if(C.pageEvent){C.pageEvent("page_tl_first",C.page_tl_first);C.pageEvent("page_tl_pre",C.page_tl_pre)}for(I=H;I<=F;I++){try{if(C.toPageN==I){if(G)B.append(G,{pageIndex:I});else C.pageEvent("page_tl_curr",B.apply({pageIndex:I}))}else if(G)$.append(G,{pageIndex:I});else C.pageEvent("page_tl_index",$.apply({pageIndex:I}))}catch(D){alert("\u5faa\u73af\u5206\u9875\u6a21\u677f\u65f6\u51fa\u9519,\u8bf7\u68c0\u67e5:pageIndex="+I);return}}if(C.toPageN<C.maxPageN)if(G)Ext.DomHelper.append(G,C.page_tl_next+C.page_tl_last);else{C.pageEvent("page_tl_next",C.page_tl_next);C.pageEvent("page_tl_last",C.page_tl_last)}_()},B=function(E){var I=$E(C.rowWrap);if(!I){alert("rowWrap\u5143\u7d20\u672a\u627e\u5230\uff0c\u8bf7\u68c0\u67e5\uff01cfg.rowWrap="+C.rowWrap);return}var F=I.tagName.toUpperCase();if(["TBODY","TABLE","TR"].indexOf(F)==-1){try{I.innerHTML=""}catch(A){alert("\u6267\u884crowWrap.innerHTML = \"\"\u5931\u8d25\uff0c\u8bf7\u901a\u77e5sky.he");return}}else{var $=I.childNodes,H=[];for(var J=0;J<$.length;J++)H.push($[J]);Ext.each(H,function($){Ext.removeNode($)})}var B=new Ext.XTemplate(Z.isArray(C.rowHtml)?C.rowHtml.join(""):C.rowHtml,C.rowFunc),_=1;for(J=0;J<E.data.length;J++){var G=E.data[J];G._index=_++;try{B.append(I,G)}catch(A){var D=confirm("\u5faa\u73afrow\u6a21\u677f\u7b2c "+G._index+" \u884c\u65f6\u51fa\u9519(\u9700\u8981\u8c03\u8bd5\u8bf7\u6309[\u786e\u5b9a]),\u8bf7\u68c0\u67e5:\r\n"+Ext.encode(G));if(D)throw(A)}}},A=function(A){if(Z.isArray(C.array)){var $={totalCount:C.array.length,"data":C.array},D=_($,function(){B($)});if(Z.isFunction(C.onload))C.onload($.totalCount,C.maxPageN);return}if(C.debug)alert("\u6253\u5370\u8c03\u8bd5\u4fe1\u606f,ajax\u8bf7\u6c42\u53c2\u6570\uff1a\r\n"+Ext.encode(A));Ext.Ajax.request({url:C.url,params:A,callback:function(G,F,$){if(F){if(C.debug)alert("\u6253\u5370\u8c03\u8bd5\u4fe1\u606f,responseText=\r\n"+$.responseText);var D=null;try{if(Z.isFunction(C.decode))D=C.decode($.responseText);else D=Ext.decode($.responseText);if(!Z.isObject(D)||!Z.isNumber(D.totalCount)||!Z.isArray(D.data)){alert("\u8fd4\u56de\u7684json\u4e32\u683c\u5f0f\u4e0d\u6b63\u786e,\u8bf7\u68c0\u67e5\uff01json\u5bf9\u8c61\u81f3\u5c11\u8981\u50cf\uff1a\r\n"+"{ totalCount:999,data:[...] } "+"\r\n\r\n\u4f46\u60a8\u7684\u8fd4\u56dejson\u4e32\u662f:\r\n"+$.responseText);return}}catch(A){alert("\u89e3\u7801gridResult\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5\uff01responseText=\r\n"+$.responseText);return}var E=_(D,function(){B(D)});if(Z.isFunction(C.onload))C.onload(D.totalCount,C.maxPageN)}else alert("xmlRequest\u7ea7\u522b\u5931\u8d25:"+$.responseText)}})},$={"id":C.id,"cfg":C,"query":function($){if(!$)$={};$.start=0;$.limit=C.pageSize;this.p=$;C.toPageN=1;A($)},"request":function($){A($)},"refresh":function(){A(this.p)}};Z.setCmp(C.id,$);return $};Z.cmp.PageList.go=function(B,_){var $=Z.getCmp(B),A=$.cfg;if(_==-1)A.toPageN--;else if(_==-2)A.toPageN++;else if(_==-3)A.toPageN=A.maxPageN;else A.toPageN=_;$.p.start=(A.toPageN-1)*A.pageSize;$.request($.p);return false}